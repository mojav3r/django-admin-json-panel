{% extends 'shared/base.html' %}
{% load custom_filters %}
{% load static %}
{% block title %}{% endblock %}

{% block content %}
    <div class="col-lg-12">
        <div class="card card-block card-stretch card-height print rounded">
            <div class="card-header d-flex justify-content-between bg-primary header-invoice">
                <div class="iq-header-title">
                    <h4 class="card-title mb-0">{{ data.json_file }} <span
                            class="badge badge-secondary">{{ data.author }}</span></h4>
                </div>
                <div class="invoice-btn">
                    <a href="{% url 'dashboard:download' pk=data.pk %}" class="btn btn-primary-dark"><i
                            class="las la-file-download"></i>Download</a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12">
                        <ul class="nav nav-pills mb-3 nav-fill" id="pills-tab-1" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="pills-home-tab-fill" data-toggle="pill"
                                   href="#pills-home-fill" role="tab" aria-controls="pills-home" aria-selected="true">Meta
                                    Data</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-profile-tab-fill" data-toggle="pill"
                                   href="#pills-profile-fill" role="tab" aria-controls="pills-profile"
                                   aria-selected="false">Result</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-contact-tab-fill" data-toggle="pill"
                                   href="#pills-contact-fill" role="tab" aria-controls="pills-contact"
                                   aria-selected="false">Json View</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="pills-tabContent-1">
                            <div class="tab-pane fade show active" id="pills-home-fill" role="tabpanel"
                                 aria-labelledby="pills-home-tab-fill">
                                {% render_meta_data data.data %}
                                <div class="content">
                                    <div id="content-display"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-profile-fill" role="tabpanel"
                                 aria-labelledby="pills-profile-tab-fill">
                                {% render_result_data data.data %}
                            </div>
                            <div class="tab-pane fade" id="pills-contact-fill" role="tabpanel"
                                 aria-labelledby="pills-contact-tab-fill">
                                <p>JSON VIEW</p>
                                <div id="jsoneditor" style="width: 100%; height: 100%;"></div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_head_ref %}
    <link href="{% static 'dist/jsoneditor.min.css' %}" media="all" rel="stylesheet">
    <script src="{% static '/dist/jsoneditor.min.js' %}"></script>
{% endblock %}

{% block extra_footer_ref %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var items = document.querySelectorAll('.nested-list > li, .nested-list .nested > li');

            items.forEach(function (item) {
                item.addEventListener('click', function (event) {
                    event.stopPropagation();
                    var contentId = item.getAttribute('data-content');
                    if (contentId) {
                        var content = document.getElementById(contentId).innerHTML;
                        document.getElementById('content-display').innerHTML = content;
                    }

                    var nestedList = item.querySelector('.nested');
                    if (nestedList) {
                        nestedList.classList.toggle('active');
                    }
                });
            });
        });
        // create the editor
        const container = document.getElementById("jsoneditor")
        var options = {
            mode: 'tree'
        };
        const editor = new JSONEditor(container, options)

        // set json
        const initialJson = {{ data.data|safe }}
            editor.set(initialJson)

        // get json
        const updatedJson = editor.get()

    </script>
{% endblock %}